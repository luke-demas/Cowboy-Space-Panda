<!DOCTYPE html><html><head><title>Cowboy Space Panda!</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui=1"><meta charset="UTF-8"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="description" content=""><link rel="manifest" href="manifest.json"><link rel="icon" type="image/png" href="icon64.png"><link rel="apple-touch-icon" sizes="180x180" href="icon180.png"><link rel="icon" type="image/png" sizes="32x32" href="icon32.png"><link rel="icon" type="image/png" sizes="16x16" href="icon16.png"><style>html,body {
  margin: 0;
  padding: 0;
  background-color: #000;
  overflow:hidden;
  font-family: Verdana;
}
.noselect {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
#canvaswrapper {
  text-align: center ;
}
</style><style>@font-face { font-family: "BitCell" ; src: url("fonts/BitCell.ttf") format("truetype"); }</style><script>window.fonts = ["BitCell"]</script></head><body class="noselect custom-cursor" oncontextmenu="return false;"><div id="canvaswrapper"></div><script type="text/javascript">var resources = {"images":[{"file":"arrow_left.png","version":11,"size":288,"properties":{"frames":1,"fps":5}},{"file":"arrow_left_choose.png","version":3,"size":286,"properties":{"frames":1,"fps":5}},{"file":"arrow_right.png","version":4,"size":276,"properties":{"frames":1,"fps":5}},{"file":"arrow_right_choose.png","version":3,"size":273,"properties":{"frames":1,"fps":5}},{"file":"blc.png","version":21,"size":532,"properties":{"frames":1,"fps":5}},{"file":"bottom.png","version":24,"size":402,"properties":{"frames":1,"fps":5}},{"file":"brc.png","version":24,"size":528,"properties":{"frames":1,"fps":5}},{"file":"icon.png","version":24,"size":555,"properties":{"frames":1,"fps":5}},{"file":"left.png","version":2,"size":440,"properties":{"frames":1,"fps":5}},{"file":"meteor.png","version":60,"size":4002,"properties":{"frames":12,"fps":5}},{"file":"player.png","version":12,"size":3305,"properties":{"frames":10,"fps":5}},{"file":"player1.png","version":1,"size":1585,"properties":{"frames":10,"fps":5}},{"file":"player1dead.png","version":1,"size":483,"properties":{"frames":1,"fps":5}},{"file":"player2.png","version":10,"size":3333,"properties":{"frames":10,"fps":5}},{"file":"player2dead.png","version":6,"size":480,"properties":{"frames":1,"fps":5}},{"file":"playercrown.png","version":17,"size":1615,"properties":{"frames":10,"fps":5}},{"file":"playercrown1.png","version":2,"size":1564,"properties":{"frames":10,"fps":5}},{"file":"playercrown1dead.png","version":1,"size":553,"properties":{"frames":1,"fps":5}},{"file":"playercrown2.png","version":22,"size":1566,"properties":{"frames":10,"fps":5}},{"file":"playercrown2dead.png","version":1,"size":551,"properties":{"frames":1,"fps":5}},{"file":"playercrowndead.png","version":4,"size":549,"properties":{"frames":1,"fps":5}},{"file":"playercrownx.png","version":15,"size":1706,"properties":{"frames":10,"fps":5}},{"file":"playerdead.png","version":8,"size":456,"properties":{"frames":1,"fps":5}},{"file":"playerhalo.png","version":33,"size":3608,"properties":{"frames":10,"fps":5}},{"file":"playerhalodead.png","version":6,"size":598,"properties":{"frames":1,"fps":5}},{"file":"playerhalox.png","version":20,"size":2379,"properties":{"frames":11,"fps":5}},{"file":"playernohat.png","version":35,"size":3169,"properties":{"frames":10,"fps":5}},{"file":"playernohatdead.png","version":3,"size":499,"properties":{"frames":1,"fps":5}},{"file":"playerrainbow.png","version":52,"size":6847,"properties":{"frames":18,"fps":5}},{"file":"playerrainbowdead.png","version":56,"size":7290,"properties":{"frames":18,"fps":5}},{"file":"playerrainbowx.png","version":24,"size":3473,"properties":{"frames":18,"fps":5}},{"file":"playersunglasses.png","version":43,"size":3158,"properties":{"frames":10,"fps":5}},{"file":"playersunglassesdead.png","version":3,"size":560,"properties":{"frames":1,"fps":5}},{"file":"playersunglassesx.png","version":15,"size":1689,"properties":{"frames":10,"fps":5}},{"file":"playertrash.png","version":202,"size":2787,"properties":{"frames":10,"fps":5}},{"file":"playertrashdead.png","version":5,"size":653,"properties":{"frames":1,"fps":5}},{"file":"playertrashx.png","version":17,"size":1773,"properties":{"frames":10,"fps":5}},{"file":"right.png","version":21,"size":423,"properties":{"frames":1,"fps":5}},{"file":"space.png","version":23,"size":242,"properties":{"frames":1,"fps":5}},{"file":"star.png","version":1,"size":3725,"properties":{"frames":18,"fps":10}},{"file":"tlc.png","version":23,"size":531,"properties":{"frames":1,"fps":5}},{"file":"top.png","version":21,"size":381,"properties":{"frames":1,"fps":5}},{"file":"trc.png","version":24,"size":531,"properties":{"frames":1,"fps":5}},{"file":"void.png","version":4,"size":203,"properties":{"frames":1,"fps":5}}],"assets":[],"maps":{"map":"{\"width\":16,\"height\":10,\"block_width\":32,\"block_height\":32,\"sprites\":[0,\"blc\",\"bottom\",\"brc\",\"left\",\"space\",\"right\",\"tlc\",\"top\",\"trc\",\"void\"],\"data\":[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10]}","map2":"{\"width\":16,\"height\":10,\"block_width\":32,\"block_height\":32,\"sprites\":[0,\"blc\",\"bottom\",\"brc\",\"left\",\"space\",\"right\",\"tlc\",\"top\",\"trc\",\"void\"],\"data\":[1,2,2,2,2,2,2,3,1,2,2,2,2,2,2,3,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,4,5,5,5,5,5,5,6,7,8,8,8,8,8,8,9,7,8,8,8,8,8,8,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10]}"},"sounds":[],"music":[]};
var graphics = "M1";

</script><script type="text/javascript">var orientation = 'landscape' ;
var aspect = '16x9' ;
var ms_libs = [] ;
window.skip_service_worker = true;
window.exported_project = true;
window.ms_use_server = false ;
</script><script src="parser.js"></script><script src="program.js"></script><script src="token.js"></script><script src="tokenizer.js"></script><script src="runner_v1_i.js"></script><script src="microengine.js"></script></body><script type="text/javascript">//
//
// The game is started with the code below.
// Once you have received the "started" signal (see below),
// you can do the following:
// 1) Inject functions or objects into the global context of the microStudio engine, example:
//
//   window.player.setGlobal("special_callback",function(x) { console.info(x) }) ;
//   // Your microScript code can now call the "special_callback" function
//
// 2) Call microScript global functions from your JavaScript code, example:
//
//   window.player.call("call_me_from_javascript",[10,1000]) ;
//   // arguments to the function call are provided as an array
//
// 3) Run a microScript code snippet from your JavaScript code, example:
//
//   window.player.exec("player.position_x = 50",function(result) { console.log(result) ; }) ;
//

window.addEventListener("load",function() {
  window.player = new Player(function(event) {
    if (event.name == "started") {
      // signal that the game is started
    }
    else if (event.name == "log") {
      // console.info(event.data) ;
    }
  }) ;
  document.body.focus() ;
}) ;

</script><script id="code" type="text/x-microscript">

// helper function to keep player in screen bounds
// from mrLman tutorials
clamp = function(value, lower_limit, upper_limit)
  local val = max(value, lower_limit)
  val = min(val, upper_limit)
  return val
end

// helper function to check distance between objects
// from mrLman tutorials
distance = function(x1, y1, x2, y2)
  local a = x2 - x1
  local b = y2 - y1
  local c = sqrt(pow(a, 2) + pow(b, 2))
  return c
end

// helper function for random range calculation
// from mrLman tutorials
randRange = function(low, high)
  return (high - low) * random.next() + low
end

// checks game mode selection
updateTitleScreen = function()
  if keyboard.press.SPACE and select == 1 then
    mode = "single"
  end
  if keyboard.press.SPACE and select == 2 then
    mode = "survival"
  end
  if keyboard.press.SPACE and select == 3  then
    mode = "multi"
  end
  if keyboard.press.SPACE and select == 4  then
    prevhat = hat
    mode = "customize"
  end
  if keyboard.press.DOWN and select < 4 then
    select += 1
  end
  if keyboard.press.UP and select > 1 then
    select -= 1
  end
  if keyboard.press.T and trash == 0 then
    trash += 1
  end
  if keyboard.press.R and trash == 1 then
    trash += 1 
  end
  if keyboard.press.A and trash == 2 then
    trash += 1 
  end
  if keyboard.press.S and trash == 3 then
    trash += 1 
  end
  if keyboard.press.H and trash == 4 and hatflag6 == 0 then
    audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
    hatflag6 = 1
    hat = 7
  end
end

// draws the title screen
drawTitleScreen = function()
  screen.drawMap("map", 0, 0, 320, 200)
  if hat != 7 then
    screen.drawText("Cowboy Space Panda!", 0, 40, 30, "rgb(227,227,0)")
  else
    screen.drawText("Cowboy Trash Panda!", 0, 40, 30, "rgb(227,227,0)")
  end
  if hat == 7 then
    screen.drawSprite("playertrash", player.x, player.y, 35, 35)
  elsif hat == 6 then
    screen.drawSprite("playerrainbow", player.x, player.y, 35, 35)
  elsif hat == 5 then
    screen.drawSprite("playerhalo", player.x, player.y, 35, 35)
  elsif hat == 4 then
    screen.drawSprite("player", player.x, player.y, 60, 60)
  elsif hat == 3 then
    screen.drawSprite("playercrown", player.x, player.y, 35, 35)
  elsif hat == 2 then
    screen.drawSprite("playersunglasses", player.x, player.y, 35, 35)
  elsif hat == 1 then
    screen.drawSprite("player", player.x, player.y, 35, 35)
  elsif hat == 0 then
    screen.drawSprite("playernohat", player.x, player.y, 35, 35)
  end
  if select == 1 then
    screen.drawText("high score: " + hiscore, 0, 90, 10, "rgb(255,255,255)")
    screen.drawText("classic mode", 0, -35, 10, "rgb(255,255,255)")
    screen.drawText("survival mode", 0, -50, 10, "rgb(227,227,0)")
    screen.drawText("multiplayer", 0, -65, 10, "rgb(227,227,0)")
    screen.drawText("customize", 0, -80, 10, "rgb(227,227,0)")
  end
  if select == 2 then
    screen.drawText("best time: " + ceil(hitime), 0, 90, 10, "rgb(255,255,255)")
    screen.drawText("classic mode", 0, -35, 10, "rgb(227,227,0)")
    screen.drawText("survival mode", 0, -50, 10, "rgb(255,255,255)")
    screen.drawText("multiplayer", 0, -65, 10, "rgb(227,227,0)")
    screen.drawText("customize", 0, -80, 10, "rgb(227,227,0)")
  end
  if select == 3 then
    screen.drawText("classic mode", 0, -35, 10, "rgb(227,227,0)")
    screen.drawText("survival mode", 0, -50, 10, "rgb(227,227,0)")
    screen.drawText("multiplayer", 0, -65, 10, "rgb(255,255,255)")
    screen.drawText("customize", 0, -80, 10, "rgb(227,227,0)")
  end
  if select == 4 then
    screen.drawText("classic mode", 0, -35, 10, "rgb(227,227,0)")
    screen.drawText("survival mode", 0, -50, 10, "rgb(227,227,0)")
    screen.drawText("multiplayer", 0, -65, 10, "rgb(227,227,0)")
    screen.drawText("customize", 0, -80, 10, "rgb(255,255,255)")
  end
end

// initializes player object
initPlayer = function()
  player = object end
  player.x = 0
  player.y = 0
  player.speed = 2
end

// initializes player 1 object (mp)
initPlayer1 = function()
  player1 = object end
  player1.x = -25
  player1.y = 0
  player1.speed = 2
end

// initializes player 2 object (mp)
initPlayer2 = function()
  player2 = object end
  player2.x = 25
  player2.y = 0
  player2.speed = 2
end

// initializes star object
initStar = function()
  star = object end
  randomizeStarPos()
end

// initializes star 1 object (mp)
initStar1 = function()
  star1 = object end
  randomizeStarPos1()
end

// initializes star 2 object (mp)
initStar2 = function()
  star2 = object end
  randomizeStarPos2()
end

// initialize meteor objects
initMeteor = function()
  meteor1 = object
    x = 300
    y = 120
    speed = 1.5
  end
  meteor2 = object
    x = -300
    y = -120
    speed = 1.5
  end
  meteor3 = object
    x = 80
    y = 200
    speed = 1.5
  end
  meteor4 = object
    x = -80
    y = -200
    speed = 1.5
  end
end

// checks for player collisions
checkCollisions = function()
  if mode == "single" then
    // get points from stars
    if distance(player.x, player.y, star.x, star.y) < 20 and hat != 4 then
      audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6")
      score += 1
      // getting to 50 points unlocks sunglasses
      if score == 50 and hatflag1 == 0 then
        audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
        hatflag1 = 1
      end
      // getting to 100 points unlocks crown
      if score == 100 and hatflag2 == 0 then
        audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
        hatflag2 = 1
      end
      if starcount > 0 then
        starcount -= 1
      end
      if starcount == 0 and hatflag5 == 0 then
        audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
        hatflag5 = 1
      end
      randomizeStarPos()
    end
    
    if distance(player.x, player.y, star.x, star.y) < 30 and hat == 4 then
      audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6")
      score += 1
      // getting to 50 points unlocks sunglasses
      if score == 50 and hatflag1 == 0 then
        audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
        hatflag1 = 1
      end
      // getting to 100 points unlocks crown
      if score == 100 and hatflag2 == 0 then
        audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
        hatflag2 = 1
      end
      if starcount > 0 then
        starcount -= 1
      end
      if starcount == 0 and hatflag5 == 0 then
        audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
        hatflag5 = 1
      end
      randomizeStarPos()
    end
    
    // lose game from meteors
    if gameover < 1 then
      if distance(player.x, player.y, meteor1.x, meteor1.y) < 30 and hat != 4 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor2.x, meteor2.y) < 30 and hat != 4 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor3.x, meteor3.y) < 30 and hat != 4 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor4.x, meteor4.y) < 30 and hat != 4 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor1.x, meteor1.y) < 40 and hat == 4 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor2.x, meteor2.y) < 40 and hat == 4 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor3.x, meteor3.y) < 40 and hat == 4 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor4.x, meteor4.y) < 40 and hat == 4 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
    end
    
  // collision detection for survival
  elsif mode == "survival" then
  // lose game from meteors
    if gameover < 1 then
      if distance(player.x, player.y, meteor1.x, meteor1.y) < 30 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor2.x, meteor2.y) < 30 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor3.x, meteor3.y) < 30 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
      if distance(player.x, player.y, meteor4.x, meteor4.y) < 30 then
        drawEndScreen()
        if deathcount > 0 then
          deathcount -= 1
        end
        if deathcount == 0 and hatflag4 == 0 then
          audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
          hatflag4 = 1
        end
        flag1 = 1
      end
    end
    
  // collision detection for multi player
  elsif mode == "multi" then
    // get points from stars
    if distance(player1.x, player1.y, star1.x, star1.y) < 20 then
      audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6")
      score += 1
      // getting to 50 points plays a special sound
      if score == 50 then
        audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
      end
      randomizeStarPos1()
    end
    if distance(player2.x, player2.y, star2.x, star2.y) < 20 then
      audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6")
      score2 += 1
      // getting to 50 points plays a special sound
      if score == 50 then
        audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
      end
      randomizeStarPos2()
    end
    
    // only end game once both players have collided with meteors (mp)
    if gameover < 1 then
      if distance(player1.x, player1.y, meteor1.x, meteor1.y) < 30 then
        player.speed = 0
        flag1 = 1
      end
      if distance(player1.x, player1.y, meteor2.x, meteor2.y) < 30 then
        player.speed = 0
        flag1 = 1
      end
      if distance(player1.x, player1.y, meteor3.x, meteor3.y) < 30 then
        player.speed = 0
        flag1 = 1
      end
      if distance(player1.x, player1.y, meteor4.x, meteor4.y) < 30 then
        player.speed = 0
        flag1 = 1
      end
      if distance(player2.x, player2.y, meteor1.x, meteor1.y) < 30 then
        player2.speed = 0
        flag2 = 1
      end
      if distance(player2.x, player2.y, meteor2.x, meteor2.y) < 30 then
        player2.speed = 0
        flag2 = 1
      end
      if distance(player2.x, player2.y, meteor3.x, meteor3.y) < 30 then
        player2.speed = 0
        flag2 = 1
      end
      if distance(player2.x, player2.y, meteor4.x, meteor4.y) < 30 then
        player2.speed = 0
        flag2 = 1
      end
      
      // flags verify now inactive collision
      if flag1 == 1 and flag2 == 1 then
        drawEndScreen()
      end
    end
  end
end

// randomly place stars in play field
randomizeStarPos = function()
  star.x = randRange(-150, 150)
  star.y = randRange(-80, 75)
end

// randomly place stars in play field (mp)
randomizeStarPos1 = function()
  star1.x = randRange(-150, -15)
  star1.y = randRange(-80, 75)
end
randomizeStarPos2 = function()
  star2.x = randRange(15, 150)
  star2.y = randRange(-80, 75)
end

// game over screen
drawEndScreen = function()
  gameover = 1
  audio.beep("saw tempo 10000 volume 50 span 50 C3 to C5 to C2 to C4")
  player.speed = 0
  player2.speed = 0
  meteor1.speed = 0
  meteor2.speed = 0
  meteor3.speed = 0
  meteor4.speed = 0
end

// hi-score global variables to keep scores between inits
hiscore = 0
hitime = 0

// menu globals to store selection choice
select = 1

// customization global variables
hat = 1
hatflag1 = 0
hatflag2 = 0
hatflag3 = 0
hatflag4 = 0
hatflag5 = 0
hatflag6 = 0
deathcount = 111
starcount = 999

// init func
init = function()
  screen.setCursorVisible(false)
  mode = "title"
  choose = 1
  initPlayer()
  initStar()
  initMeteor()
  score = 0
  score2 = 0
  timee = 0
  flag1 = 0
  flag2 = 0
  gameover = 0
  prevhat = 1
  trash = 0
  initPlayer1()
  initPlayer2()
  initStar1()
  initStar2()
end

// update func
update = function()
  // display title screen
  if mode == "title" then
    updateTitleScreen()
    
  elsif mode == "customize" then
    if keyboard.press.LEFT and choose == 1 then
      if hat > 0 then
        hat -= 1
      end
    end
    if keyboard.press.RIGHT and choose == 1 then
      if hat < 7 then
        hat += 1
      end
    end
    if keyboard.press.SPACE and choose == 2 then
      if hat == 2 and hatflag1 == 0 then
        hat = prevhat
      end
      if hat == 3 and hatflag2 == 0 then
        hat = prevhat
      end
      if hat == 4 and hatflag3 == 0 then
        hat = prevhat
      end
      if hat == 5 and hatflag4 == 0 then
        hat = prevhat
      end
      if hat == 6 and hatflag5 == 0 then
        hat = prevhat
      end
      if hat == 7 and hatflag6 == 0 then
        hat = prevhat
      end
      choose = 1
      mode = "title"
    end
    if keyboard.press.DOWN and choose < 2 then
      choose += 1
    end
    if keyboard.press.UP and choose > 1 then
      choose -= 1
    end
  
  // display single player mode
  elsif mode == "single" or mode == "multi" then
    // player movement controls
    if keyboard.W then
      player.y += player.speed
      player1.y += player.speed
    end
    if keyboard.S then
      player.y -= player.speed
      player1.y -= player.speed
    end
    if keyboard.D then
      player.x += player.speed
      player1.x += player.speed
    end
    if keyboard.A then
      player.x -= player.speed
      player1.x -= player.speed
    end
    if gameover > 0 then
      if keyboard.SPACE then
        init()
      end
    end
  
    // keep player within game bounds
    player.x = clamp(player.x, -150, 150)
    player.y = clamp(player.y, -80, 80)
  
    // move meteors
    meteor1.y -= meteor1.speed
    if meteor1.y < -120 then
      meteor1.y = 120
      meteor1.x = randRange(-150, 150)
      meteor1.speed = randRange(1, 3)
    end
    meteor2.y += meteor2.speed
    if meteor2.y > 120 then
      meteor2.y = -120
      meteor2.x = randRange(-150, 150)
      meteor2.speed = randRange(1, 3)
    end
    meteor3.x -= meteor3.speed
    if meteor3.x < -190 then
      meteor3.y = randRange(-80, 80)
      meteor3.x = 190
      meteor3.speed = randRange(1, 3)
    end
    meteor4.x += meteor4.speed
    if meteor4.x > 190 then
      meteor4.y = randRange(-80, 80)
      meteor4.x = -190
      meteor4.speed = randRange(1, 3)
    end
  
    // check collisions
    checkCollisions()
    
    // player 2 movement controls
    if keyboard.ARROW_UP then
      player2.y += player2.speed
    end
    if keyboard.ARROW_DOWN then
      player2.y -= player2.speed
    end
    if keyboard.ARROW_RIGHT then
      player2.x += player2.speed
    end
    if keyboard.ARROW_LEFT then
      player2.x -= player2.speed
    end
  
    // keep multiplayer within game bounds
    player1.x = clamp(player1.x, -150, -10)
    player1.y = clamp(player1.y, -80, 80)
    player2.x = clamp(player2.x, 10, 150)
    player2.y = clamp(player2.y, -80, 80)
  
    //update hi-score
    if score > hiscore then
      hiscore = score
    end
  
  // display survival mode 
  elsif mode == "survival" then
    // update time
    if flag1 == 0 then
      timee += 1/60
    end
    
    if timee >= 119 and hatflag3 == 0 then
      audio.beep("saw volume 50 duration 100 span 80 C5 G5 volume 40 C6 C8 C6 G5 C5 C3")
      hatflag3 = 1
    end
    
    //update hi-time
    if timee > hitime then
      hitime = timee
    end
    
    // player movement controls
    if keyboard.W then
      player.y += player.speed
    end
    if keyboard.S then
      player.y -= player.speed
    end
    if keyboard.D then
      player.x += player.speed
    end
    if keyboard.A then
      player.x -= player.speed
    end
    if gameover > 0 then
      if keyboard.SPACE then
        init()
      end
    end
  
    // keep player within game bounds
    player.x = clamp(player.x, -150, 150)
    player.y = clamp(player.y, -80, 80)
  
    // move meteors
    meteor1.y -= meteor1.speed
    if meteor1.y < -120 then
      meteor1.y = 120
      meteor1.x = randRange(-150, 150)
      meteor1.speed = randRange(1, 3)
    end
    meteor2.y += meteor2.speed
    if meteor2.y > 120 then
      meteor2.y = -120
      meteor2.x = randRange(-150, 150)
      meteor2.speed = randRange(1, 3)
    end
    meteor3.x -= meteor3.speed
    if meteor3.x < -190 then
      meteor3.y = randRange(-80, 80)
      meteor3.x = 190
      meteor3.speed = randRange(1, 3)
    end
    meteor4.x += meteor4.speed
    if meteor4.x > 190 then
      meteor4.y = randRange(-80, 80)
      meteor4.x = -190
      meteor4.speed = randRange(1, 3)
    end
  
    // check collisions
    checkCollisions()
  
  // display multi player mode
  elsif mode == "multi" then
    // player movement controls
    if keyboard.W then
      player1.y += player.speed
    end
    if keyboard.S then
      player1.y -= player.speed
    end
    if keyboard.D then
      player1.x += player.speed
    end
    if keyboard.A then
      player1.x -= player.speed
    end
    if gameover > 0 then
      if keyboard.SPACE then
        init()
      end
    end
    
    // move meteors
    meteor1.y -= meteor1.speed
    if meteor1.y < -120 then
      meteor1.y = 120
      meteor1.x = randRange(-150, 150)
      meteor1.speed = randRange(1, 3)
    end
    meteor2.y += meteor2.speed
    if meteor2.y > 120 then
      meteor2.y = -120
      meteor2.x = randRange(-150, 150)
      meteor2.speed = randRange(1, 3)
    end
    meteor3.x -= meteor3.speed
    if meteor3.x < -190 then
      meteor3.y = randRange(-80, 80)
      meteor3.x = 190
      meteor3.speed = randRange(1, 3)
    end
    meteor4.x += meteor4.speed
    if meteor4.x > 190 then
      meteor4.y = randRange(-80, 80)
      meteor4.x = -190
      meteor4.speed = randRange(1, 3)
    end
  
    // check collisions
    checkCollisions()
    
    // player 2 movement controls
    if keyboard.ARROW_UP then
      player2.y += player2.speed
    end
    if keyboard.ARROW_DOWN then
      player2.y -= player2.speed
    end
    if keyboard.ARROW_RIGHT then
      player2.x += player2.speed
    end
    if keyboard.ARROW_LEFT then
      player2.x -= player2.speed
    end
  
    // keep multiplayer within game bounds
    player1.x = clamp(player1.x, -150, -10)
    player1.y = clamp(player1.y, -80, 80)
    player2.x = clamp(player2.x, 10, 150)
    player2.y = clamp(player2.y, -80, 80)
  end
end

// draw func
draw = function()
  // clear the screen
  screen.clear()
  
  // draw title screen
  if mode == "title" then
    drawTitleScreen()
    
  elsif mode == "customize" then
    screen.drawMap("map", 0, 0, 320, 200)
    screen.drawText("Customize", 0, 40, 20, "rgb(227,227,0)")
    
    if choose == 1 then
      if hat > 0 then
        screen.drawSprite("arrow_left_choose", -30, 0, 10, 10)
      end
      if hat < 7 then
        screen.drawSprite("arrow_right_choose", 30, 0, 10, 10)
      end
      screen.drawText("return to menu", 0, -55, 10, "rgb(277,277,0)")
    elsif choose == 2 then
      if hat > 0 then
        screen.drawSprite("arrow_left", -30, 0, 10, 10)
      end
      if hat < 7 then
        screen.drawSprite("arrow_right", 30, 0, 10, 10)
      end
      screen.drawText("return to menu", 0, -55, 10, "rgb(255,255,255)")
    end
    
    if hat == 7 then
      if hatflag6 == 0 then
        screen.drawSprite("playertrashx", player.x, player.y, 35, 35)
        screen.drawText("enter the secret code", 0, -35, 5, "rgb(277,277,0)")
      elsif hatflag6 == 1 then 
        screen.drawSprite("playertrash", player.x, player.y, 35, 35)
      end
    elsif hat == 6 then
      if hatflag5 == 0 then
        screen.drawSprite("playerrainbowx", player.x, player.y, 35, 35)
        screen.drawText("collect " + starcount + " more stars", 0, -35, 5, "rgb(277,277,0)")
      elsif hatflag5 == 1 then 
        screen.drawSprite("playerrainbow", player.x, player.y, 35, 35)
      end
    elsif hat == 5 then
      if hatflag4 == 0 then
        screen.drawSprite("playerhalox", player.x, player.y, 35, 35)
        screen.drawText("die " + deathcount + " more times", 0, -35, 5, "rgb(277,277,0)")
      elsif hatflag4 == 1 then 
        screen.drawSprite("playerhalo", player.x, player.y, 35, 35)
      end
    elsif hat == 4 then
      if hatflag3 == 0 then
        screen.drawSprite("playerrainbowx", player.x, player.y, 60, 60)
        screen.drawText("survive for 2 minutes in survival", 0, -35, 5, "rgb(277,277,0)")
      elsif hatflag3 == 1 then 
        screen.drawSprite("player", player.x, player.y, 60, 60)
      end
    elsif hat == 3 then
      if hatflag2 == 0 then
        screen.drawSprite("playercrownx", player.x, player.y, 35, 35)
        screen.drawText("reach a high score of 100 in classic", 0, -35, 5, "rgb(277,277,0)")
      elsif hatflag2 == 1 then 
        screen.drawSprite("playercrown", player.x, player.y, 35, 35)
      end
    elsif hat == 2 then
      if hatflag1 == 0 then
        screen.drawSprite("playersunglassesx", player.x, player.y, 35, 35)
        screen.drawText("reach a high score of 50 in classic", 0, -35, 5, "rgb(277,277,0)")
      elsif hatflag1 == 1 then 
        screen.drawSprite("playersunglasses", player.x, player.y, 35, 35)
      end
    elsif hat == 1 then
      screen.drawSprite("player", player.x, player.y, 35, 35)
    elsif hat == 0 then
      screen.drawSprite("playernohat", player.x, player.y, 35, 35)
    end
  
  // draw single player and survival screen elements
  elsif mode == "single" then
    // draw star
    screen.drawSprite("star", star.x, star.y, 15, 15)
    
    // draw map
    screen.drawMap("map", 0, 0, 320, 200)
  
    // draw star
    screen.drawSprite("star", star.x, star.y, 15, 15)
  
    // draw panda
    if hat == 1 then
      if flag1 == 0 then
        screen.drawSprite("player", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playerdead", player.x, player.y, 35, 35)
      end
    elsif hat == 0 then
      if flag1 == 0 then
        screen.drawSprite("playernohat", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playernohatdead", player.x, player.y, 35, 35)
      end
    elsif hat == 2 then
      if flag1 == 0 then
        screen.drawSprite("playersunglasses", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playersunglassesdead", player.x, player.y, 35, 35)
      end
    elsif hat == 3 then
      if flag1 == 0 then
        screen.drawSprite("playercrown", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playercrowndead", player.x, player.y, 35, 35)
      end
    elsif hat == 4 then
      if flag1 == 0 then
        screen.drawSprite("player", player.x, player.y, 60, 60)
      elsif flag1 == 1 then
        screen.drawSprite("playerdead", player.x, player.y, 60, 60)
      end
    elsif hat == 5 then
      if flag1 == 0 then
        screen.drawSprite("playerhalo", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playerhalodead", player.x, player.y, 35, 35)
      end
    elsif hat == 6 then
      if flag1 == 0 then
        screen.drawSprite("playerrainbow", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playerrainbowdead", player.x, player.y, 35, 35)
      end
    elsif hat == 7 then
      if flag1 == 0 then
        screen.drawSprite("playertrash", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playertrashdead", player.x, player.y, 35, 35)
      end
    end
  
    // draw meteors
    screen.drawSprite("meteor", meteor1.x, meteor1.y, 40)
    screen.drawSprite("meteor", meteor2.x, meteor2.y, 40)
    screen.drawSprite("meteor", meteor3.x, meteor3.y, 40)
    screen.drawSprite("meteor", meteor4.x, meteor4.y, 40)

    // draw game over screen
    if gameover > 0 then
      screen.drawText("GAME OVER", 0, 30, 30, "rgb(277,277,0)")
      screen.drawText("Press space to restart.", 0, -60, 10, "rgb(277,277,0)")
    end
    
    // draw score
    screen.drawText("score: " + score, -127, 90, 10,"rgb(255,255,255)")
    screen.drawText("high score: " + hiscore, 0, 90, 10, "rgb(255,255,255)")
    
  elsif mode == "survival" then
    // draw map
    screen.drawMap("map", 0, 0, 320, 200)
  
    // draw panda
    if hat == 1 then
      if flag1 == 0 then
        screen.drawSprite("player", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playerdead", player.x, player.y, 35, 35)
      end
    elsif hat == 0 then
      if flag1 == 0 then
        screen.drawSprite("playernohat", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playernohatdead", player.x, player.y, 35, 35)
      end
    elsif hat == 2 then
      if flag1 == 0 then
        screen.drawSprite("playersunglasses", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playersunglassesdead", player.x, player.y, 35, 35)
      end
    elsif hat == 3 then
      if flag1 == 0 then
        screen.drawSprite("playercrown", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playercrowndead", player.x, player.y, 35, 35)
      end
    elsif hat == 4 then
      if flag1 == 0 then
        screen.drawSprite("player", player.x, player.y, 60, 60)
      elsif flag1 == 1 then
        screen.drawSprite("playerdead", player.x, player.y, 60, 60)
      end
    elsif hat == 5 then
      if flag1 == 0 then
        screen.drawSprite("playerhalo", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playerhalodead", player.x, player.y, 35, 35)
      end
    elsif hat == 6 then
      if flag1 == 0 then
        screen.drawSprite("playerrainbow", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playerrainbowdead", player.x, player.y, 35, 35)
      end
    elsif hat == 7 then
      if flag1 == 0 then
        screen.drawSprite("playertrash", player.x, player.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playertrashdead", player.x, player.y, 35, 35)
      end
    end
  
    // draw meteors
    screen.drawSprite("meteor", meteor1.x, meteor1.y, 40)
    screen.drawSprite("meteor", meteor2.x, meteor2.y, 40)
    screen.drawSprite("meteor", meteor3.x, meteor3.y, 40)
    screen.drawSprite("meteor", meteor4.x, meteor4.y, 40)

    // draw game over screen
    if gameover > 0 then
      screen.drawText("GAME OVER", 0, 30, 30, "rgb(277,277,0)")
      screen.drawText("Press space to restart.", 0, -60, 10, "rgb(277,277,0)")
    end
    
    // draw score
    screen.drawText("time: " + ceil(timee), -127, 90, 10,"rgb(255,255,255)")
    screen.drawText("best time: " + ceil(hitime), 0, 90, 10, "rgb(255,255,255)")
  
  // draw multi player screen
  elsif mode == "multi" then
    // draw map
    screen.drawMap("map2", 0, 0, 320, 200)
  
    // draw star
    screen.drawSprite("star", star1.x, star1.y, 15, 15)
    screen.drawSprite("star", star2.x, star2.y, 15, 15)
  
    // draw pandas
    // get crown hat if score reaches 50
    // change sprite upon game over
    if score2 < 50 then
      if flag2 == 0 then
        screen.drawSprite("player2", player2.x, player2.y, 35, 35)
      elsif flag2 == 1 then
        screen.drawSprite("player2dead", player2.x, player2.y, 35, 35)
      end
    else
      if flag2 == 0 then
        screen.drawSprite("playercrown2", player2.x, player2.y, 35, 35)
      elsif flag2 == 1 then
        screen.drawSprite("playercrown2dead", player2.x, player2.y, 35, 35)
      end
    end
    if score < 50 then
      if flag1 == 0 then
        screen.drawSprite("player1", player1.x, player1.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("player1dead", player1.x, player1.y, 35, 35)
      end
    else
      if flag1 == 0 then
        screen.drawSprite("playercrown1", player1.x, player1.y, 35, 35)
      elsif flag1 == 1 then
        screen.drawSprite("playercrown1dead", player1.x, player1.y, 35, 35)
      end
    end
  
    // draw meteors
    screen.drawSprite("meteor", meteor1.x, meteor1.y, 40)
    screen.drawSprite("meteor", meteor2.x, meteor2.y, 40)
    screen.drawSprite("meteor", meteor3.x, meteor3.y, 40)
    screen.drawSprite("meteor", meteor4.x, meteor4.y, 40)
  
    // draw scores
    screen.drawText("p1 score: " + score, -127, 90, 10,"rgb(255,255,255)")
    screen.drawText("p2 score: " + score2, 127, 90, 10, "rgb(255,255,255)")

    // draw game over screen
    // declare winner based on highest score
    if gameover > 0 then
      screen.drawText("GAME OVER", 0, 30, 30, "rgb(277,277,0)")
      if score > score2 then
        screen.drawText("WINNER!", -80, -15, 20, "rgb(0,255,255)")
        screen.drawText("LOSER.", 80, -15, 20, "rgb(255,0,85)")
      elsif score2 > score then
        screen.drawText("LOSER.", -80, -15, 20, "rgb(0,255,255)")
        screen.drawText("WINNER!", 80, -15, 20, "rgb(255,0,85)")
      else
        screen.drawText("Tie", -80, -15, 20, "rgb(255,255,255)")
        screen.drawText("Tie", 80, -15, 20, "rgb(255,255,255)")
      end
      screen.drawText("Press space to restart.", 0, -60, 10, "rgb(277,277,0)")
    end
  end
end

</script></html>